<!doctype html>
<html>
  <link href="/css/tweets.css" rel="stylesheet" type="text/css">
  <%- include('partials/header') %>
  <script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  <script>
    window.user = `<%= user.id %>`;
  </script>
  <body>
    <div id="sidebar" class="sidebar">
      <br>
      <ul class="list-group tweet-list">
      </ul>
      <div>
        <form action="">
          <button name="show" class="btn btn-primary show-btn">Show</button>
          <button name="remove" class="btn btn-danger remove-btn">Delete</button>
        </form>
      </div>
    </div>
    <div style='height: 50px'>
      <div id='sucess-banner' class="col-md-6 offset-md-3 alert alert-success" role="alert" style='display:none;'>
      </div>
    </div>
    <div class="container">
      <form action="/tweets/add/" method="post">
        <label for="tweet">Enter Tweet ID: </label>
        <input id="tweet" type="text" name="url_field" value="">
        <button name="add" class="btn btn-primary add-btn">Add</button>
      </form>
      <div class="row">
        <% for (var i = 0; i < tweets.length; i++) { %>
          <div class="col-md-4 hijack">
            <div id="<%= tweets[i] %>"></div>
            <div class="row col-md-2 offset-md-5">
              <input type="checkbox" id="tweet-<%=tweets[i]%>" name="tweet-<%=tweets[i]%>" value="<%=tweets[i]%>" class="tweets" style="visibility: hidden">
            </div>
          </div>
        <% } %>
      </div>
    </div>
  </body>
  <% if (typeof libs !== 'undefined') { %>
    <% for (let lib of libs) { %>
        <script src='/js/<%= lib %>.js' type='text/javascript'></script>
    <% } %>
  <% } %>
</html>
<%- include('partials/footer') %>

<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script>
  $(function () {
    var tweets = <%- JSON.stringify(tweets) %>;
    for (var i = 0; i < tweets.length; i++) {
      twttr.widgets.createTweet(
        tweets[i],
        document.getElementById(tweets[i]),
        {
          theme: 'light',
          conversation: 'none',
          cards: 'hidden',
          width: 550,
        }
      );
      $(`#${tweets[i]}`).on('click', function(){
        tweet_id = $(this).attr('id')
        var checkbox = $(`#tweet-${tweet_id}`);
        if(!checkbox.prop("checked")){
          $(`#${tweet_id}`).css('outline', '2px solid blue')
          $(".tweet-list").append(`<li class="list-group-item tweet-list-${tweet_id}">tweet id ${tweet_id} </li>`);
          openNav();
          checkbox.prop('checked', true);
        } else {
          $(`#${tweet_id}`).css('outline', '')
          $(`.tweet-list-${tweet_id}`).remove();
          checkbox.prop('checked', false);
          if ( $('#sidebar ul li').length == 0 ) {
            closeNav();
          }
        }
      });
    };
  });

  function openNav() {
    document.getElementById("sidebar").style.width = "250px";
  }

  function closeNav() {
    document.getElementById("sidebar").style.width = "0";
  }
</script>